# 性能瓶颈

CPU瓶颈：动画系统；业务逻辑：AI等；寻路；碰撞检测；DrawCall

GPU瓶颈：顶点数、面数；Overdraw；Shader过于复杂



**DrawCall优化**

1.静态合批（勾选static）

预先将静态的物体网格和贴图进行合并

但是会增加额外的内存占用，空间换时间

2.动态合批

会把一些小的Mesh合并成一个大的Mesh

需要使用同一个材质球，顶点数量有限制

3.SRP Batcher

要求同一Shader（可以不同的材质球）

要求是SRP（URP或HDRP）

4.自己手动GPU Instance

Graphics.DrawMeshInstance

需要自己实现裁减

Shader需要兼容



**动画系统优化**

帧动画：每一帧都是不同的网格；每帧切换不同的网格就能达到动画的效果；缺点是每个网格都需要进行存储，空间占用大

骨骼动画：每帧更新骨骼旋转和位置信息；对每一个顶点，根据其依赖的骨骼和对应的权重进行变化和插值；优点是存储小、动画制作相对容易、动画融合容易；缺点是所有顶点需要在运行时每帧都进行计算

可以用**GPU SKinning**进行优化

实现方式：事先将动画中的骨骼旋转位移信息烘焙到贴图中；预先将顶点的骨骼权重记录在顶点信息中；运行时将动画信息传递给材质球；顶点shader根据当前动画信息，计算出偏移，从贴图中读取骨骼旋转偏移信息；顶点shader中根据骨骼旋转偏移信息，加上顶点中记录的骨骼权重，计算出最终的在Object空间中的顶点偏移

缺点：动画需要预烘焙，需要增加计算量，需要自己实现Animator状态机



CPU瓶颈：运算转移到GPU，预烘焙等

GPU瓶颈：Imposter，LOD，减少透明面片总面积

